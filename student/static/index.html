<!DOCTYPE html>
<html>

<head>
    <title>Student Management</title>
</head>

<body>

    <h2>Add Student</h2>
    <input type="number" id="studentId" placeholder="Student ID">
    <input type="text" id="studentName" placeholder="Student Name">
    <input type="text" id="marksInput"
        placeholder='[{"subject": "Math", "marks": 85}, {"subject": "Science", "marks": 90}]'>
    <button id="addStudentButton">Add Student</button>

    <h2>Get Student Marks</h2>
    <input type="number" id="studentIdForMarks" placeholder="Enter Student ID">
    <button id="getStudentMarksButton">Get Student Marks</button>

    <h2>Get All Students</h2>
    <button id="getAllStudentsButton">Get All Students</button>

    <div id="result"></div>

    <script>
        const addStudentButton = document.getElementById('addStudentButton');
        const getStudentMarksButton = document.getElementById('getStudentMarksButton');
        const getAllStudentsButton = document.getElementById('getAllStudentsButton');
        const studentId = document.getElementById('studentId');
        const studentName = document.getElementById('studentName');
        const marksInput = document.getElementById('marksInput');
        const studentIdForMarks = document.getElementById('studentIdForMarks');
        const resultDiv = document.getElementById('result');

        const baseUrl = 'http://localhost:8000';

        const addStudent = async () => {
            const studentIdValue = parseInt(studentId.value);
            const studentNameValue = studentName.value;
            const marks = JSON.parse(marksInput.value);

            try {
                const response = await fetch(`${baseUrl}/students/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        "student_id": studentIdValue,
                        "name": studentNameValue,
                        "marks": marks
                    })
                });

                if (response.ok) {
                    resultDiv.textContent = "Student added successfully!";
                } else {
                    resultDiv.textContent = "Error adding student.";
                }
            } catch (error) {
                resultDiv.textContent = `Error: ${error}`;
            }
        };

        const getStudentMarks = async () => {
            const studentIdValue = parseInt(studentIdForMarks.value);

            try {
                const response = await fetch(`${baseUrl}/students/${studentIdValue}`);
                const data = await response.json();

                if (response.ok) {
                    resultDiv.innerHTML = `<h2>Student Marks</h2>`;
                    const ul = document.createElement('ul');
                    data.marks.forEach(mark => {
                        const li = document.createElement('li');
                        li.textContent = `${mark.subject}: ${mark.marks}`;
                        ul.appendChild(li);
                    });
                    resultDiv.appendChild(ul);
                } else {
                    resultDiv.textContent = "Error fetching student marks.";
                }
            } catch (error) {
                resultDiv.textContent = `Error: ${error}`;
            }
        };

        const getAllStudents = async () => {
            try {
                const response = await fetch(`${baseUrl}/students/`);
                const data = await response.json();

                if (response.ok) {
                    resultDiv.innerHTML = "<h2>All Students</h2>";
                    const ul = document.createElement('ul');
                    data.forEach(student => {
                        const li = document.createElement('li');
                        li.textContent = `Student ID: ${student.student_id}, Name: ${student.name}`;
                        ul.appendChild(li);
                    });
                    resultDiv.appendChild(ul);
                } else {
                    resultDiv.textContent = "Error fetching students.";
                }
            } catch (error) {
                resultDiv.textContent = `Error: ${error}`;
            }
        };

        addStudentButton.addEventListener('click', addStudent);
        getStudentMarksButton.addEventListener('click', getStudentMarks);
        getAllStudentsButton.addEventListener('click', getAllStudents);
    </script>

</body>

</html>